<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>HernándezStore</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
    :root { 
        --accent:#f5c542; 
        --bg:#111; 
        --panel:#1a1a1a; 
        --panel2:#222; 
        --text:#fff; 
        --muted:#ccc; 
        --ok:#28a745; 
        --danger:#dc3545; 
        --warning:#ffc107; 
    }
    *{box-sizing:border-box}
    body { 
        background:var(--bg); 
        color:var(--text); 
        font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
        margin:0; 
        padding:0; 
        display:flex; 
        flex-direction:column; 
        min-height:100vh; 
        line-height:1.6;
    }
    
    header { 
        background:var(--panel2); 
        padding:1rem; 
        text-align:center; 
        font-size:1.8rem; 
        font-weight:bold; 
        position:relative;
        box-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }
    .menu-toggle { 
        display:none; 
        position:absolute; 
        left:1rem; 
        top:50%; 
        transform:translateY(-50%); 
        background:none; 
        border:none; 
        font-size:1.5rem; 
        color:var(--text); 
        cursor:pointer; 
    }
    .welcome { 
        background:linear-gradient(135deg, var(--panel), var(--panel2)); 
        padding:1rem; 
        text-align:center; 
        font-size:1.1rem; 
        border-bottom:1px solid #333; 
    }
    .welcome strong { color:var(--accent); }
    .top-bar { 
        display:flex; 
        flex-wrap:wrap; 
        gap:1rem; 
        padding:1rem; 
        background:var(--panel); 
        border-bottom:1px solid #333; 
        align-items:center; 
        justify-content:center; 
        transition:max-height 0.3s ease; 
        overflow:hidden; 
    }
    .top-bar.show { max-height:500px; }
    .categories { display:flex; gap:0.5rem; flex-wrap:wrap; }
    .categories button { 
        background:#333; 
        color:#fff; 
        border:none; 
        padding:0.6rem 1.2rem; 
        border-radius:25px; 
        cursor:pointer; 
        transition:all .2s ease;
        font-weight: 500;
    }
    .categories button:hover { 
        transform:translateY(-2px); 
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    .categories button.active { 
        background:var(--accent); 
        color:#000; 
        font-weight:bold; 
    }
    .search-box input { 
        padding:0.6rem 1rem; 
        border-radius:25px; 
        border:none; 
        outline:none; 
        background:#222; 
        color:#fff; 
        min-width: 250px;
        font-size: 0.95rem;
    }
    .search-box input::placeholder {
        color: #999;
    }
    
    .productos { 
        flex:1; 
        display:grid; 
        grid-template-columns:repeat(auto-fill, minmax(280px, 1fr)); 
        gap:1.5rem; 
        padding:2rem 1rem; 
        max-width: 1400px;
        margin: 0 auto;
        width: 100%;
    }
    
    .card { 
        position:relative; 
        background:var(--panel); 
        border-radius:16px; 
        overflow:hidden; 
        display:flex; 
        flex-direction:column; 
        box-shadow:0 4px 20px rgba(0,0,0,0.3); 
        transition:all .3s ease; 
        border: 1px solid #333;
    }
    .card:hover { 
        transform:translateY(-8px); 
        box-shadow:0 12px 40px rgba(0,0,0,.5); 
        border-color: var(--accent);
    }
    .card.out-of-stock { 
        opacity:0.6; 
        filter: grayscale(0.3);
    }
    .card.out-of-stock:hover { 
        transform:translateY(-4px); 
        box-shadow:0 8px 25px rgba(0,0,0,.3); 
    }
    
    .card-image {
        position: relative;
        height: 220px;
        overflow: hidden;
        background: #222;
    }
    
    .card-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s ease;
    }
    
    .card:hover .card-image img {
        transform: scale(1.05);
    }
    
    .card.out-of-stock:hover .card-image img {
        transform: scale(1);
    }
    
    .badge { 
        position:absolute; 
        top:0.8rem; 
        left:0.8rem; 
        background:var(--accent); 
        color:#000; 
        font-weight:700; 
        padding:0.3rem 0.6rem; 
        border-radius:20px; 
        font-size:0.8rem; 
        z-index:3; 
    }
    
    .stock-badge { 
        position:absolute; 
        top:0.8rem; 
        right:0.8rem; 
        font-weight:600; 
        padding:0.3rem 0.6rem; 
        border-radius:20px; 
        font-size:0.75rem; 
        z-index:3; 
    }
    .stock-high { background:var(--ok); color:#fff; }
    .stock-low { background:var(--warning); color:#000; }
    .stock-out { background:var(--danger); color:#fff; }
    
    .card-content { 
        padding:1.2rem; 
        display:flex; 
        flex-direction:column; 
        gap:0.8rem; 
        flex: 1;
    }
    
    .card h3 { 
        margin:0; 
        font-size:1.25rem; 
        line-height:1.3; 
        color: var(--text);
        font-weight: 600;
    }
    
    .card-description {
        color: var(--muted);
        font-size: 0.9rem;
        line-height: 1.4;
        margin: 0;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
    
    .price-section {
        margin: 0.5rem 0;
    }
    
    .price { 
        display:flex; 
        align-items:center; 
        gap:0.8rem; 
        margin-bottom: 0.5rem;
    }
    .price .now { 
        font-weight:700; 
        font-size: 1.3rem;
        color: var(--accent);
    }
    .price .old { 
        color:var(--muted); 
        text-decoration:line-through; 
        font-size:1rem; 
    }
    
    .stock-info { 
        font-size:0.85rem; 
        color:var(--muted); 
        margin:0.5rem 0; 
    }
    .stock-info.low { color:var(--warning); }
    .stock-info.out { color:var(--danger); }
    
    .card-footer {
        padding: 0 1.2rem 1.2rem;
        margin-top: auto;
    }
    
    .btn-comprar { 
        width: 100%;
        background:var(--ok); 
        color:#fff; 
        border:none; 
        padding:0.8rem 1rem; 
        border-radius:10px; 
        cursor:pointer; 
        transition:all .2s ease; 
        font-weight: 600;
        font-size: 0.95rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    .btn-comprar:hover { 
        background: #218838;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
    }
    .btn-comprar:disabled { 
        background:#555; 
        cursor:not-allowed; 
        opacity:0.6; 
        transform: none;
        box-shadow: none;
    }
    .btn-comprar:disabled:hover { 
        background:#555; 
        transform: none;
        box-shadow: none;
    }
    .btn-comprar.loading { 
        background:#666; 
        cursor:wait; 
    }
    
    /* Modal de confirmación mejorado */
    .modal-overlay { 
        position:fixed; 
        top:0; 
        left:0; 
        right:0; 
        bottom:0; 
        background:rgba(0,0,0,0.85); 
        z-index:1000; 
        display:none; 
        align-items:center; 
        justify-content:center; 
        padding:1rem; 
        backdrop-filter: blur(5px);
    }
    .modal-overlay.show { 
        display:flex; 
        animation: fadeIn 0.3s ease;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    
    .modal { 
        background:var(--panel); 
        border-radius:16px; 
        max-width:450px; 
        width:100%; 
        padding:2rem; 
        position:relative; 
        box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        border: 1px solid #333;
        animation: slideUp 0.3s ease;
    }
    
    @keyframes slideUp {
        from { transform: translateY(50px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }
    
    .modal h3 { 
        margin:0 0 1.5rem 0; 
        color:var(--accent); 
        font-size: 1.4rem;
        text-align: center;
    }
    
    .product-summary {
        background: var(--panel2);
        border-radius: 12px;
        padding: 1.5rem;
        margin: 1rem 0;
        border: 1px solid #333;
    }
    
    .product-summary h4 {
        margin: 0 0 0.8rem 0;
        color: var(--text);
        font-size: 1.1rem;
    }
    
    .product-summary .price-display {
        font-size: 1.2rem;
        font-weight: bold;
        color: var(--accent);
        margin: 0.5rem 0;
    }
    
    .quantity-selector { 
        display:flex; 
        align-items:center; 
        justify-content: center;
        gap:1rem; 
        margin:1.5rem 0; 
        background: var(--panel2);
        padding: 1rem;
        border-radius: 10px;
    }
    
    .quantity-btn { 
        width:40px; 
        height:40px; 
        border:none; 
        background:var(--accent); 
        color:#000; 
        border-radius:8px; 
        cursor:pointer; 
        font-weight:bold; 
        font-size: 1.2rem;
        transition: all 0.2s ease;
    }
    .quantity-btn:hover {
        transform: scale(1.1);
    }
    .quantity-btn:disabled { 
        background:#555; 
        color:#999; 
        cursor:not-allowed; 
        transform: none;
    }
    
    .quantity-input { 
        width:80px; 
        text-align:center; 
        padding:0.8rem; 
        border:2px solid #666; 
        border-radius:8px; 
        background:var(--bg); 
        color:var(--text); 
        font-size: 1.1rem;
        font-weight: bold;
    }
    
    .total-section {
        background: var(--panel2);
        padding: 1rem;
        border-radius: 10px;
        margin: 1rem 0;
        text-align: center;
        border: 2px solid var(--accent);
    }
    
    .total-label {
        color: var(--muted);
        font-size: 0.9rem;
        margin: 0;
    }
    
    .total-amount {
        color: var(--accent);
        font-size: 1.8rem;
        font-weight: bold;
        margin: 0.5rem 0;
    }
    
    .modal-buttons { 
        display:flex; 
        gap:1rem; 
        margin-top:2rem; 
    }
    .modal-buttons button { 
        flex:1; 
        padding:1rem; 
        border:none; 
        border-radius:10px; 
        cursor:pointer; 
        font-weight:bold; 
        transition:all .2s ease; 
        font-size: 0.95rem;
        text-transform: uppercase;
    }
    .btn-confirm { 
        background:var(--ok); 
        color:#fff; 
    }
    .btn-confirm:hover {
        background: #218838;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
    }
    .btn-cancel { 
        background:#666; 
        color:#fff; 
    }
    .btn-cancel:hover {
        background: #555;
        transform: translateY(-2px);
    }
    
    .loading-state {
        text-align: center;
        padding: 4rem 2rem;
        color: var(--muted);
    }
    
    .loading-state h3 {
        color: var(--accent);
        margin-bottom: 1rem;
    }
    
    footer { 
        background:var(--panel); 
        padding:2rem 1rem; 
        text-align:center; 
        font-size:0.9rem; 
        border-top:1px solid #333; 
        line-height:1.6; 
        margin-top: auto;
    }
    footer strong { color:var(--accent); }
    
    /* Responsive */
    @media (max-width: 768px) {
        .productos {
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
            padding: 1rem 0.5rem;
        }
        
        .card-content {
            padding: 1rem;
        }
        
        .modal {
            margin: 1rem;
            padding: 1.5rem;
        }
        
        .top-bar {
            flex-direction: column;
            gap: 1rem;
        }
        
        .search-box input {
            min-width: 200px;
        }
        
        .menu-toggle {
            display: block;
        }
    }
</style>
</head>
<body>
<header>
    <button class="menu-toggle" id="menuToggle">☰</button>
    HernándezStore
</header>
<div class="welcome">
    <strong>Bienvenido a HernándezStore</strong> 🛍️
</div>
<div class="top-bar" id="topBar">
    <div class="categories" id="categoryButtons"></div>
    <div class="search-box">
        <input type="text" id="searchInput" placeholder="Buscar producto...">
    </div>
</div>
<div id="productos" class="productos">
    <div class="loading-state">
        <h3>Cargando productos...</h3>
        <p>Por favor espera un momento</p>
    </div>
</div>

<!-- Modal de confirmación de compra -->
<div class="modal-overlay" id="purchaseModal">
    <div class="modal">
        <h3>🛒 Confirmar Compra</h3>
        <div class="product-summary">
            <h4 id="modalProductName">Nombre del producto</h4>
            <p id="modalProductDesc">Descripción del producto</p>
            <div class="price-display" id="modalProductPrice">S/. 0.00</div>
        </div>
        
        <div class="quantity-selector">
            <button class="quantity-btn" id="decreaseBtn" onclick="changeQuantity(-1)">-</button>
            <input type="number" class="quantity-input" id="quantityInput" value="1" min="1" readonly>
            <button class="quantity-btn" id="increaseBtn" onclick="changeQuantity(1)">+</button>
        </div>
        
        <div class="total-section">
            <p class="total-label">Total a pagar:</p>
            <div class="total-amount" id="totalAmount">S/. 0.00</div>
        </div>
        
        <div class="modal-buttons">
            <button class="btn-cancel" onclick="closePurchaseModal()">Cancelar</button>
            <button class="btn-confirm" onclick="confirmPurchase()">✅ Confirmar compra</button>
        </div>
    </div>
</div>

<footer>
    <strong>HernándezStore</strong><br>
    💖 Tu confianza es nuestra prioridad 💖<br>
    💵 Pagos contra entrega (📱 Yape | 🤳 Plin | 🏦 Transferencia)
</footer>

<script>
let allProducts = [];
let filteredProducts = [];
let categories = [];
let currentProduct = null;
let currentQuantity = 1;

// Cargar productos desde la API real
async function loadProducts(){
    try {
        const container = document.getElementById('productos');
        container.innerHTML = `
            <div class="loading-state">
                <h3>Cargando productos...</h3>
                <p>Conectando con el servidor...</p>
            </div>
        `;
        
        const response = await fetch('/api/data');
        if (!response.ok) {
            throw new Error(`Error HTTP: ${response.status} - ${response.statusText}`);
        }
        const data = await response.json();
        
        allProducts = data.products || [];
        categories = data.categories || [];
        
        if (allProducts.length === 0) {
            container.innerHTML = `
                <div class="loading-state">
                    <h3>No hay productos disponibles</h3>
                    <p>Ve al <a href="/admin.html" style="color: var(--accent);">panel de administración</a> para añadir productos</p>
                </div>
            `;
            return;
        }
        
        renderCategories();
        filteredProducts = [...allProducts];
        renderProducts(filteredProducts);
        
    } catch(err) {
        console.error("Error al cargar productos:", err);
        document.getElementById('productos').innerHTML = `
            <div class="loading-state">
                <h3>Error al cargar productos</h3>
                <p>Por favor, recarga la página</p>
            </div>
        `;
    }
}

function renderCategories(){
    const container = document.getElementById('categoryButtons');
    container.innerHTML = '';
    
    const allBtn = document.createElement('button');
    allBtn.textContent = 'Todos';
    allBtn.classList.add('active');
    allBtn.onclick = () => { 
        setActiveCategory(allBtn); 
        filteredProducts = [...allProducts]; 
        applySearchAndRender(); 
    };
    container.appendChild(allBtn);
    
    categories.forEach(cat => {
        const btn = document.createElement('button');
        btn.textContent = cat.label || cat.name;
        btn.onclick = () => {
            setActiveCategory(btn);
            filteredProducts = allProducts.filter(p => 
                p.category && (
                    p.category.toLowerCase() === (cat.name||'').toLowerCase() ||
                    p.category.toLowerCase() === (cat.label||'').toLowerCase()
                )
            );
            applySearchAndRender();
        };
        container.appendChild(btn);
    });
}

function setActiveCategory(activeBtn){
    document.querySelectorAll('.categories button').forEach(b => b.classList.remove('active'));
    activeBtn.classList.add('active');
}

function renderProducts(list){
    const container = document.getElementById('productos');
    if(!list || list.length === 0){
        container.innerHTML = `
            <div class="loading-state">
                <h3>No hay productos disponibles</h3>
                <p>Intenta cambiar los filtros o buscar algo diferente</p>
            </div>
        `;
        return;
    }
    
    container.innerHTML = '';
    list.forEach(product => {
        const hasDiscount = product.discount && product.discount > 0;
        const finalPrice = hasDiscount ? (product.price * (1 - product.discount / 100)) : product.price;
        const stockStatus = getStockStatus(product.stock);
        const firstImage = product.images && product.images.length > 0 ? product.images[0] : '/api/placeholder/280/220';
        
        container.innerHTML += `
            <div class="card ${product.stock <= 0 ? 'out-of-stock' : ''}">
                <div class="card-image">
                    <img src="${firstImage}" alt="${product.name}" onerror="this.src='/api/placeholder/280/220'">
                    ${hasDiscount ? `<div class="badge">-${product.discount}%</div>` : ''}
                    <div class="stock-badge ${stockStatus.class}">${stockStatus.text}</div>
                </div>
                <div class="card-content">
                    <h3>${product.name}</h3>
                    <p class="card-description">${product.shortDesc || 'Sin descripción disponible'}</p>
                    <div class="price-section">
                        <div class="price">
                            <span class="now">S/. ${finalPrice.toFixed(2)}</span>
                            ${hasDiscount ? `<span class="old">S/. ${product.price.toFixed(2)}</span>` : ''}
                        </div>
                        <div class="stock-info ${stockStatus.class}">
                            ${product.stock > 0 ? `Disponible: ${product.stock} unidades` : 'Sin stock'}
                        </div>
                    </div>
                </div>
                <div class="card-footer">
                    <button class="btn-comprar" 
                            ${product.stock <= 0 ? 'disabled' : ''} 
                            onclick="openPurchaseModal(${product.id})">
                        ${product.stock <= 0 ? 'Sin Stock' : '🛒 Comprar Ahora'}
                    </button>
                </div>
            </div>
        `;
    });
}

function getStockStatus(stock) {
    if (stock <= 0) return { class: 'stock-out', text: 'Sin Stock' };
    if (stock <= 5) return { class: 'stock-low', text: 'Pocas Unidades' };
    return { class: 'stock-high', text: 'Disponible' };
}

function openPurchaseModal(productId) {
    currentProduct = allProducts.find(p => p.id === productId);
    if (!currentProduct) return;
    
    currentQuantity = 1;
    updateModalContent();
    document.getElementById('purchaseModal').classList.add('show');
    document.body.style.overflow = 'hidden'; // Evitar scroll del body
}

function closePurchaseModal() {
    document.getElementById('purchaseModal').classList.remove('show');
    document.body.style.overflow = 'auto';
    currentProduct = null;
    currentQuantity = 1;
}

function updateModalContent() {
    if (!currentProduct) return;
    
    const hasDiscount = currentProduct.discount && currentProduct.discount > 0;
    const finalPrice = hasDiscount ? (currentProduct.price * (1 - currentProduct.discount / 100)) : currentProduct.price;
    
    document.getElementById('modalProductName').textContent = currentProduct.name;
    document.getElementById('modalProductDesc').textContent = currentProduct.shortDesc || 'Sin descripción disponible';
    document.getElementById('modalProductPrice').textContent = `S/. ${finalPrice.toFixed(2)}${hasDiscount ? ` (${currentProduct.discount}% desc.)` : ''}`;
    document.getElementById('quantityInput').value = currentQuantity;
    document.getElementById('totalAmount').textContent = `S/. ${(finalPrice * currentQuantity).toFixed(2)}`;
    
    // Actualizar botones de cantidad
    document.getElementById('decreaseBtn').disabled = currentQuantity <= 1;
    document.getElementById('increaseBtn').disabled = currentQuantity >= currentProduct.stock;
}

function changeQuantity(change) {
    if (!currentProduct) return;
    
    const newQuantity = currentQuantity + change;
    if (newQuantity >= 1 && newQuantity <= currentProduct.stock) {
        currentQuantity = newQuantity;
        updateModalContent();
    }
}

function confirmPurchase() {
    if (!currentProduct) return;
    
    const hasDiscount = currentProduct.discount && currentProduct.discount > 0;
    const finalPrice = hasDiscount ? (currentProduct.price * (1 - currentProduct.discount / 100)) : currentProduct.price;
    const total = finalPrice * currentQuantity;
    
    // Crear mensaje para WhatsApp
    let message = `🛒 *¡Hola! He confirmado mi compra*\n\n`;
    message += `📦 *Producto:* ${currentProduct.name}\n`;
    message += `📝 *Descripción:* ${currentProduct.shortDesc || 'Sin descripción'}\n`;
    message += `🔢 *Cantidad:* ${currentQuantity} ${currentQuantity > 1 ? 'unidades' : 'unidad'}\n`;
    message += `💰 *Precio unitario:* S/. ${finalPrice.toFixed(2)}`;
    if (hasDiscount) {
        message += ` *(${currentProduct.discount}% descuento)*`;
    }
    message += `\n💳 *Total a pagar:* S/. ${total.toFixed(2)}\n\n`;
    message += `¡Gracias! Espero su confirmación para proceder con el pedido. 😊`;
    
    const whatsappNumber = "51929528308"; // Formato internacional
    const encodedMessage = encodeURIComponent(message);
    const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${encodedMessage}`;
    
    // Cerrar modal y abrir WhatsApp
    closePurchaseModal();
    window.open(whatsappUrl, '_blank');
}

function applySearchAndRender(){
    const term = (document.getElementById('searchInput').value || '').toLowerCase();
    const list = filteredProducts.filter(p =>
        (p.name||'').toLowerCase().includes(term) ||
        (p.shortDesc||'').toLowerCase().includes(term) ||
        (p.category||'').toLowerCase().includes(term)
    );
    renderProducts(list);
}

// Event listeners
document.getElementById('searchInput').addEventListener('input', applySearchAndRender);

// Cerrar modal al hacer clic fuera
document.getElementById('purchaseModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closePurchaseModal();
    }
});

// Cerrar modal con Escape
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closePurchaseModal();
    }
});

// Menú responsive
document.getElementById('menuToggle').addEventListener('click', function() {
    document.getElementById('topBar').classList.toggle('show');
});

// Inicializar
loadProducts();
</script>
</body>
</html>
